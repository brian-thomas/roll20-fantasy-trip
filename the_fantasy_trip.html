<div class="sheet-block sheet-bottom-padding">

 <div class="sheet-flex">

   <div class="sheet-header-left sheet-padding">
     <div class="sheet-thick-border sheet-padding">

       <div class="sheet-inline-flex sheet-bottom-padding">
         <span class="sheet-bold-font sheet-left-pad">Name:</span>
         <input type="text" class="sheet-text-align-left sheet-info-name-long" name="attr_character_name"/>
       </div>

       <div class="sheet-inline-flex">
         <select class="sheet-info-name" name="attr_class">
          <option selected="selected" value="none">--</option>
          <option value="hero">Hero</option>
          <option value="wizard">Wizard</option>
         </select>

         <select class="sheet-info-name" name="attr_race">
           <option selected="selected" value="Human">Human</option>
           <option value="Dwarf">Dwarf</option>
           <option value="Elven">Elven</option>
           <option value="Goblin">Goblin</option>
           <option value="Halfling">Halfling</option>
           <option value="HalfElven">Half Elven</option>
           <option value="HalfGoblin">Half Goblin</option>
           <option value="HalfDwarf">Half Dwarf</option>
           <option value="HalfOrc">Half Orc</option>
           <option value="Orc">Orc</option>
         </select>

         <input type="text" class="sheet-align-right sheet-info-name" name="attr_xp" value="0"/>
         <input type="text" class="sheet-align-right inactive-color sheet-next-level-notify sheet-info-name" name="attr_xp_required" value="0" readonly="true"/>
       </div>

       <div class="sheet-inline-flex sheet-bottom-padding">
         <span class="sheet-info-name">Class</span>
         <span class="sheet-info-name">Race</span>
         <span class="sheet-info-name">XP</span>
         <span class="sheet-info-name">XP Required</span>
       </div>

       <div class="sheet-inline-flex">
            <input type="text" class="sheet-info-name-med sheet-text-align-left" name="attr_background"/>
            <input type="text" class="sheet-info-name-med sheet-text-align-left" name="attr_job"/>
            <input type="text" class="sheet-info-name-sm sheet-text-align-left" name="attr_job_pay"/>
            <input type="text" class="sheet-info-name-sm sheet-text-align-left" name="attr_job_risk"/>
        </div>

        <div class="sheet-inline-flex sheet-bottom-padding">
            <span class="sheet-info-name-med">Background</span>
            <span class="sheet-info-name-med">Job</span>
            <span class="sheet-info-name-sm">Pay</span>
            <span class="sheet-info-name-sm">Risk</span>
        </div>

        <div class="sheet-thin-border sheet-padding">
          <h4>Talent, Language, Spell Costs</h4>
          <div class="sheet-center">
            <span class="sheet-left-pad">Start IQ:<span>
            <input type="number" name="attr_iq_start" class="sheet-info-name-sm sheet-bold-font" value="8"/>
            <span class="sheet-left-pad">Unspent Pts:<span>
            <input type="number" name="attr_tls_iq_unspent" class="sheet-info-name-sm sheet-inactive-color sheet-bold-font" value="0" readonly="true"/>
            <span class="sheet-left-pad">XP Req:<span>
            <input type="number" name="attr_tls_xp_cost" class="sheet-info-name-sm sheet-inactive-color sheet-bold-font" value="0" readonly="true"/>
          </div>
        </div>

      </div>
   </div>

   <div class="sheet-header-right sheet-padding">
     <div class="sheet-noborder">
          <img src="https://raw.githubusercontent.com/brian-thomas/roll20-fantasy-trip-charsheet/master/logo.jpg" alt="The Fantasy Trip Logo" class="sheet-logo">
     </div>
   </div>

  </div>

  <br/>

  <div class="sheet-flex-inline">

    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab1" value="1" checked="checked" />
    <span class="sheet-tab sheet-tab1">Core</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab2" value="2" />
    <span class="sheet-tab sheet-tab2">Combat</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab3" value="3" />
    <span class="sheet-tab sheet-tab3">Languages</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab4" value="4" />
    <span class="sheet-tab sheet-tab4">Spellcasting</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab5" value="5" />
    <span class="sheet-tab sheet-tab5">Gear</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab6" value="6" />
    <span class="sheet-tab sheet-tab6">Notes</span>
    <input type="radio" name="attr_tab" class="bottom-padding sheet-tab sheet-tab99" value="99" />
    <span class="sheet-tab sheet-tab99">Show All</span>

    <br/>
    <br/>

    <div class="section-core">
      <div class="sheet-flex">
        <div class="sheet-header-left sheet-padding">
           <div class="sheet-thick-border sheet-padding">
             <div class="sheet-flex sheet-center sheet-bottom-padding">
               <h3>Attributes</h3>
             </div>
             <div class="sheet-flex-between sheet-center sheet-bottom-padding">
               <span>Attrib Total:</span>
               <input type="number" name="attr_total_attribs" class="sheet-info-name-sm sheet-inactive-color" value="24" readonly="True"/>
               <span class="sheet-left-pad">XP Required:</span>
               <input type="number" name="attr_attrib_xp_spent" class="sheet-info-name sheet-inactive-color" value="8000" readonly="True"/>
               <span>Next Attrib XP Cost:</span>
               <input type="text" class="sheet-align-right inactive-color sheet-next-level-notify sheet-info-name" name="attr_next_attrib_xp" value="0" readonly="true"/>
             </div>
             <div class="sheet-block sheet-thin-border sheet-top-padding">
               <div class="sheet-flex">
                 <div class="sheet-ability-column-value">
                   <span class="sheet-big-font">ST</span>
                   <input class="ability-value" name="attr_st" type="number" value="8"/>
                 </div>
                 <div class="sheet-ability-column-bonus">
                   <span class="ability-check-bonus-label">bonus</span>
                   <input type="number" name="attr_st_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                 </div>
                 <div class="sheet-ability-column-modifier sheet-flex">
                   <div class="sheet-ability-column-bonus">
                     <span class="ability-check-bonus-label">Adj ST</span>
                     <input name="attr_adj_st" type="number" value="8" class="sheet-ability-modifier inactive-color" readonly="true"/>
                   </div>
                   <span class="noborder left-pad">Wounds, Fatigue, Encumbrance, Poison Resistance</span>
                 </div>
                 <div class="sheet-ability-column-roll sheet-flex">
                   <button class="sheet-ability-button" type="roll" name="roll_st_check"
                           value="&{template:roll_check} {{character_name=@{character_name}}} {{title=ST Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 3d6 vs @{adj_st}}} {{noadvroll=1}} {{roll1=[[ 3d6 ]]}}"></button>
                 </div>
               </div>

               <div class="sheet-flex">
                 <div class="sheet-ability-column-value">
                   <span class="sheet-big-font">DX</span>
                   <input class="ability-value" name="attr_dx" type="number" value="8"/>
                 </div>
                 <div class="sheet-ability-column-bonus">
                   <span class="ability-check-bonus-label">bonus</span>
                   <input type="number" name="attr_dx_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                 </div>
                 <div class="sheet-ability-column-modifier sheet-flex">
                   <div class="sheet-ability-column-bonus">
                     <span class="ability-check-bonus-label">Adj DX</span>
                     <input name="attr_adj_dx" type="number" value="8" class="sheet-ability-modifier inactive-color" readonly="true"/>
                   </div>
                   <span class="noborder left-pad">Order of Action, Attack and Spellcasting Success, Dodge</span>
                 </div>
                 <div class="sheet-ability-column-roll sheet-flex">
                   <button class="sheet-ability-button" type="roll" name="roll_dx_check"
                           value="&{template:roll_check} {{character_name=@{character_name}}} {{title=DX Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{dexterity_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dexterity_mod}]] ]]}}"></button>
                 </div>
               </div>

               <div class="sheet-flex">
                 <div class="sheet-ability-column-value">
                   <span class="sheet-big-font">IQ</span>
                   <input class="ability-value" name="attr_iq" type="number" value="8"/>
                 </div>
                 <div class="sheet-ability-column-bonus">
                   <span class="ability-check-bonus-label">bonus</span>
                   <input type="number" name="attr_iq_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                 </div>
                 <div class="sheet-ability-column-modifier sheet-flex">
                   <div class="sheet-ability-column-bonus">
                     <span class="ability-check-bonus-label">Adj IQ</span>
                     <input name="attr_adj_iq" type="number" value="8" class="sheet-ability-modifier inactive-color" readonly="true"/>
                   </div>
                   <span class="noborder left-pad">Notice, Allowed Spells, Starting Talents, Resist Magic</span>
                 </div>
                 <div class="sheet-ability-column-roll sheet-flex">
                   <button class="sheet-ability-button" type="roll" name="roll_iq_check"
                           value="&{template:roll_check} {{character_name=@{character_name}}} {{title=IQ Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{constitution_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{constitution_mod}]] ]]}}"></button>

                 </div>
               </div>

               <div class="sheet-flex">
                 <div class="sheet-ability-column-value">
                   <span class="sheet-big-font">MA</span>
                   <input class="ability-value inactive-color" name="attr_move" type="number" value="8" readonly="True"/>
                 </div>
                 <div class="sheet-ability-column-bonus">
                   <span class="ability-check-bonus-label">bonus</span>
                   <input type="number" name="attr_move_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                 </div>
                 <div class="sheet-ability-column-modifier sheet-flex">
                   <div class="sheet-ability-column-bonus">
                     <span class="ability-check-bonus-label">Adj MA</span>
                     <input name="attr_adj_move" type="number" value="8" class="sheet-ability-modifier inactive-color" readonly="true"/>
                   </div>
                   <span class="noborder left-pad">Movement Rate</span>
                 </div>
               </div>

             </div>
           </div>
        </div>

        <div class="sheet-header-right sheet-padding">


          <div class="sheet-thick-border sheet-padding">
            <h3>Talents</h3>
            <div class="sheet-center">
              <span class="sheet-left-pad">Talent Cost:<span>
              <input type="number" name="attr_total_talent_cost" class="sheet-info-name-sm sheet-inactive-color sheet-bold-font" value="0"/>
            </div>
            <fieldset class="repeating_talents">
              <div class="sheet-block sheet-thin-border sheet-side-padding">
                  <input type="text" name="attr_talentname" class="sheet-bottom-line sheet-talent-name"/>
                  <span class="left-pad">Cost:</span>
                  <select class="sheet-info-name-sm sheet-bold-font sheet-align-right" name="attr_talent_cost">
                    <option value="0">0</option>
                    <option selected="selected" value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                  </select>
                  <span class="left-pad">IQ req:</span>
                  <select class="sheet-info-name-sm sheet-align-right sheet-bold-font" name="attr_talent_iq_required">
                    <option selected="selected" value="7">7</option>
                    <option value="7">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                  </select>
                  <!--
                  <button class="sheet-talent-button" type="roll" name="roll_talent"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{talentname} Check}} {{subheader=@{character_name}}} {{talent=1}} {{math=roll: 1d20 }} {{noadvroll=1}} {{roll1=[[1d20]] }}"></button>
                  -->
                <textarea spellcheck="false" name="attr_talent_description" class="sheet-talent-description" data-i18n-placeholder="description"></textarea>
              </div>
           </fieldset>
         </div>
       </div>
     </div>
   </div>

    <div class="section-combat">
      <div class="sheet-thick-border sheet-padding">
        <h3>Combat</h3>
        <div class="sheet-flex-between sheet-bottom-padding">
          <div class="sheet-thin-border">
            <div class="sheet-flex">
              <div class="sheet-block">
                  <input class="ability-check-value inactive-color" name="attr_initiative" type="number" value="0" readonly="true"/>
                  <span class="ability-check-label">Initiative Bonus</span>
              </div>
              <button type="roll" class="sheet-initiative" name="roll_initiative"
                     value="&{template:roll_check} {{title=Initiative}} {{subheader=@{character_name}}} {{initiative=1}} {{rollname=Initiative}} {{roll=[[ 1d20 + @{initiative} [Initiative Mod] &{tracker} ]]}}">Roll Init.</button>

            </div>
          </div>
          <div class="sheet-ability-column-value">
            <input class="ability-check-value inactive-color" name="attr_ac_hits" type="number" value="0" readonly="true"/>
            <span class="ability-check-label">Hits Stopped</span>
          </div>
          <div class="sheet-ability-column-value">
            <input class="ability-check-value" name="attr_wound_dam" type="number" value="0"/>
            <span class="ability-check-label">Wounds</span>
          </div>
          <div class="sheet-ability-column-value">
            <input class="ability-check-value" name="attr_fatigue_dam" type="number" value="0"/>
            <span class="ability-check-label">Fatigue</span>
          </div>
        </div>
        <div class="sheet-thin-border">
          <h4>Weapons</h4>
          <div class="sheet-block">
            <div class="sheet-inline-flex">

              <span class="sheet-weapon-param-name sheet-rotate sheet-bold-font sheet-italic-font">Notches</span>
              <span class="sheet-weapon-name sheet-bold-font">Name</span>
              <span class="sheet-weapon-param-name sheet-bold-font">Add. Bonus</span>
              <span class="sheet-weapon-param-select-name sheet-bold-font">Type</span>
              <span class="sheet-weapon-param-name sheet-bold-font">Attk Bonus</span>
              <span class="sheet-weapon-param-select-name sheet-bold-font">Damage</span>
              <span class="sheet-weapon-param-name sheet-bold-font">Dam Bonus</span>
              <span class="sheet-weapon-param-name sheet-bold-font">Stnd. Attack</span>

            </div>
            <fieldset class="repeating_weapons">
              <div class="sheet-inline-flex">

                <select class="sheet-weapon-notches" name="attr_weapon_notches">
                  <option selected="selected" value="0">--</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                </select>
                <input type="text" name="attr_weapon_name" class="weapon-name" data-i18n-placeholder="name"/>
                <input type="number" name="attr_weapon_bonus" class="weapon-param sheet-purple-border" value="0"/>

                <select class="weapon-param" name="attr_weapon_type">
                  <option selected="selected" value="@{melee_ab}">Melee</option>
                  <option value="@{ranged_ab}">Ranged</option>
                </select>

                <input type="number" name="attr_weapon_attack_bonus" class="weapon-param inactive-color" value="[[@{weapon_type}+[[@{weapon_bonus}]]-[[@{weapon_notches}]]]]" disabled="true"/>

                <select class="sheet-weapon-param" name="attr_weapon_dam_die">
                  <option selected="selected" value="1d6-4">1d6-4</option>
                  <option value="1d6-2">1d6-2</option>
                  <option value="1d6-1">1d6-1</option>
                  <option value="1d6">1d6</option>
                  <option value="1d6+1">1d6+1</option>
                  <option value="1d6+2">1d6+2</option>
                  <option value="2d6-2">2d6-2</option>
                  <option value="2d6-1">2d6-1</option>
                  <option value="2d6">2d6</option>
                  <option value="2d6+1">2d6+1</option>
                  <option value="2d6+2">2d6+2</option>
                  <option value="3d6-2">3d6-2</option>
                  <option value="3d6-1">3d6-1</option>
                  <option value="3d6">3d6</option>
                  <option value="3d6+1">3d6+1</option>
                  <option value="3d6+2">3d6+2</option>
                  <option value="3d6+3">3d6+3</option>
                </select>

                <input name="attr_weapon_dam" value="0" hidden="true"/>
                <input type="number" name="attr_weapon_dam_bonus" class="weapon-param inactive-color" value="[[@{strength_mod}+[[@{weapon_bonus}]]]]" disabled="true"/>

                <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_weapon_attack"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{weapon_name} Attack}} {{subheader=@{character_name}}} {{weapon=1}} {{attack=[[ 1d20 + [[@{weapon_attack_bonus}]] ]]}} {{critical=[[19 + @{weapon_attack_bonus}]]}} {{fumble=[[2+@{weapon_attack_bonus}]] }} {{damage=[[@{weapon_dam} + [[@{weapon_dam_bonus}]] ]]}} {{critdamage=[[@{weapon_dam} + [[@{weapon_dam}]] + [[@{weapon_dam_bonus}]] ]]}} {{math=1d20 + [[@{weapon_attack_bonus}]] [Attack], @{weapon_dam} + @{weapon_dam_bonus} [Damage] }}"></button>

              </div>
            </fieldset>
          </div>
        </div>
      </div>
    </div>


    <div class="section-languages">
       <div class="sheet-thick-border sheet-languages">
         <h3>Languages</h3>
         <div class="sheet-center">
           <span class="sheet-left-pad">Num Languages:<span>
           <input type="number" name="attr_num_lang" class="sheet-info-name-sm sheet-inactive-color sheet-bold-font" value="0"/>
         </div>
         <fieldset class="repeating_languages">
             <div class="sheet-langcontainer sheet-side-padding">
               <input type="text" name="attr_language_name" class="sheet-language-name sheet-bottom-line" data-i18n-placeholder="language name"/>
               <!--
               <span class="left-pad">Cost:</span>
               <input type="number" name="attr_language_cost" class="sheet-info-name-sm sheet-bold-font" value="1"/>
               -->
             </div>
         </fieldset>
       </div>
    </div>

    <div class="section-magic">
      <div class="sheet-thick-border sheet-spells">
        <h3>Spellcasting</h3>
        <div class="sheet-center">
          <span class="sheet-left-pad">Num Spells:<span>
          <input type="number" name="attr_num_spells" class="sheet-info-name-sm sheet-inactive-color sheet-bold-font" value="0"/>
        </div>
        <div class="sheet-spell-filters sheet-flex-between">
          <span class="sheet-bold-font">Filter:</span>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="all" checked/>
             <span data-i18n="all"></span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="8"/>
             <span>8</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="9"/>
             <span>9</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="10"/>
             <span>10</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="11"/>
             <span>11</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="12"/>
             <span>12</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="13"/>
             <span>13</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="14"/>
             <span>14</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="15"/>
             <span>15</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="16"/>
             <span>16</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="17"/>
             <span>17</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="18"/>
             <span>18</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="19"/>
             <span>19</span>
          </label>
          <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="20"/>
             <span>20</span>
          </label>
        </div>

        <h4>Spells Known</h4>
        <fieldset class="repeating_spells">
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="8" checked="True"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="9"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="10"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="11"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="12"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="13"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="14"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="15"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="16"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="17"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="18"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="19"/>
          <input type="checkbox" name="attr_spell_iq" class="sheet-hidden-spell-iq" value="20"/>
          <div class="sheet-spellcontainer sheet-side-padding">
            <input type="text" name="attr_spellname" class="sheet-spell-name sheet-bottom-line" data-i18n-placeholder="spell name"/>
            <span class="sheet-left-pad"> IQ:</span>
            <select class="sheet-info-name-sm sheet-align-right" name="attr_spell_iq">
              <option selected="selected" value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
            </select>
            <span class="sheet-left-pad">Dice:</span>
            <input type="text" class="sheet-align-right sheet-spell-dice" name="attr_spell_dice" value="">
            <input type="checkbox" name="attr_is_dice_spell" class="sheet-is-dice-spell" value="1" hidden="True">
            <div class="sheet-dice-spell">
              <button class="sheet-attack-button sheet-orange-border" type="roll" name="roll_cast_spell"
                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell=1}} {{spell_dice_enabled=1}} {{level=@{spell_iq}}} {{math=@{spell_dice}}} {{roll1=[[@{spell_dice}]]}} {{description=@{spelldescription}}}"></button>
            </div>
            <div class="sheet-no-dice-spell">
              <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_cast_spell"
                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell=1}} {{level=@{spell_iq}}} }} {{description=@{spelldescription} }}"></button>
            </div>
            <textarea spellcheck="false" name="attr_spelldescription" class="sheet-spell-description" data-i18n-placeholder="description"></textarea>
          </div>
        </fieldset>
      </div>
    </div>

    <div class="section-inventory">
      <div class="sheet-thick-border">
        <h3>Gear</h3>
        <div class="sheet-flex">
          <div class="sheet-gear-left sheet-padding">
            <div class="sheet-thin-border sheet-padding">
              <h4>Worn / Ready</h4>
              <div class="sheet-table sheet-fill-width sheet-padding">
                <div class="sheet-table-row sheet-inline-flex sheet-bottom-pad">
                  <div class="">
                    <span class="sheet-bold-font sheet-info-name-med sheet-gear-name">Ready Weapon: </span>
                  </div>
                  <div class="">
                    <input type="text" class="sheet-info-name-med-long sheet-gear-name" name="attr_ready_weapon"/>
                  </div>
                </div>
                <div class="sheet-table-row sheet-inline-flex sheet-bottom-pad">
                  <div class="">
                    <span class="sheet-bold-font sheet-gear-name sheet-info-name-med">2nd Weapon: </span>
                  </div>
                  <div class="">
                    <input type="text" class="sheet-info-name-med-long sheet-gear-name" name="attr_second_weapon"/>
                  </div>
                </div>
                <div class="sheet-table-row sheet-inline-flex sheet-bottom-pad">
                  <div class=" sheet-center">
                    <span class="sheet-bold-font sheet-info-name-sm">Armor: </span>
                  </div>
                  <div class="">
                    <select name="attr_armor" class="sheet-armor-name">
                      <option selected="selected" value="none">Clothing</option>
                      <option value="padded">Padded</option>
                      <option value="leather">Leather</option>
                      <option value="studded_leather">Std. Leather</option>
                      <option value="scale">Scale</option>
                      <option value="chain">Chain</option>
                      <option value="half_plate">Half Plate</option>
                      <option value="plate">Plate</option>
                    </select>
                  </div>
                  <div class="sheet-center">
                    <input type="number" class="sheet-armor-param center sheet-purple-border" name="attr_armor_bonus" value="-1"/>
                    <span class="sheet-bold-font sheet-info-name-med">bonus</span>
                  </div>
                  <div class=" sheet-left-pad">
                    <span class="sheet-bold-font sheet-info-name-sm">Shield: </span>
                  </div>
                  <div class="">
                    <select name="attr_shield" class="sheet-armor-name">
                      <option selected="selected" value="none">None</option>
                      <option value="small_shield">Small Shield</option>
                      <option value="large_shield">Large Shield</option>
                      <option value="tower_shield">Tower Shield</option>
                    </select>
                  </div>
                  <div class="sheet-center">
                    <input type="number" class="sheet-armor-param center sheet-purple-border" name="attr_shield_bonus" value="0"/>
                    <span class="sheet-bold-font sheet-info-name-med">bonus</span>
                  </div>
                </div>
                <div class="sheet-table-row sheet-inline-flex sheet-bottom-pad">
                  <div class="">
                    <span class="sheet-bold-font sheet-info-name-med sheet-gear-name">Belt: </span>
                  </div>
                  <div class="">
                    <input type="text" class="sheet-info-name-med-long sheet-gear-name" name="attr_belt"/>
                  </div>
                </div>
                <div class="sheet-table-row sheet-inline-flex sheet-bottom-pad">
                  <div class="">
                    <span class="sheet-bold-font sheet-info-name-med sheet-gear-name">Belt Pouch: </span>
                  </div>
                  <div class="">
                    <input type="text" class="sheet-info-name-med-long sheet-gear-name" name="attr_belt_pouch"/>
                  </div>
                </div>
              </div>
            </div>
            <div class="sheet-thin-border sheet-padding">
              <h4>Non-Encumbering Items</h4>
              <textarea class="sheet-med-textarea" spellcheck="false" name="attr_non_encumber_items" data-i18n-placeholder="non-encumbering items"></textarea>
            </div>
          </div>
          <div class="sheet-gear-right sheet-padding">
            <div class="sheet-thin-border sheet-padding">
              <h4>Backpack</h4>
              <div class="table sheet-fill-width">
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input type="text" class="sheet-item-name-header sheet-inactive-color" value="Item" readonly="True"/></div>
                  <div class="table-cell"><input type="text" class="sheet-item-weight-header sheet-inactive-color" value="Wgt" readonly="True"></div>
                </div>
                <div class="table-row sheet-table-sep-row"></div>
                <div class="table-row sheet-table-sep-row"></div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-1" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-1-wgt" type="number" value="0" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-2" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-2-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-3" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-3-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-4" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-4-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-5" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-5-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-table-sep-row"></div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-6" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-6-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-7" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-7-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-8" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-8-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-9" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-9-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-10" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-10-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-table-sep-row"></div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-11" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-11-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-12" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-12-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-13" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-13-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-14" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-14-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-flex-simple">
                  <div class="table-cell"><input name="attr_backpack_slot-15" type="text" class="sheet-item-name"/></div>
                  <div class="table-cell"><input name="attr_backpack_slot-15-wgt" type="number" value="" class="sheet-item-weight"/></div>
                </div>
                <div class="table-row sheet-table-sep-row"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sheet-section-notes">
      <span class="sheet-spacer">&nbsp;</span>
      <div class="sheet-thick-border">
        <h3>Notes</h3>
        <textarea class="sheet-lrg-textarea" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
      </div>
    </div>

  </div>

</div>

<!-- Sheet Workers -->
<script type="text/worker">

  // Attribute/XP stuff
  on(`sheet:opened change:st change:st_bonus change:dx change:dx_bonus change:iq change:iq_bonus`, () => {
    getAttrs(['st', 'dx', 'iq', 'st_bonus', 'dx_bonus', 'iq_bonus'], v => {

      const st = parseInt(v.st) || 0;
      const st_bonus = parseInt(v.st_bonus) || 0;

      const dx = parseInt(v.dx) || 0;
      const dx_bonus = parseInt(v.dx_bonus) || 0;

      const iq = parseInt(v.iq) || 0;
      const iq_bonus = parseInt(v.iq_bonus) || 0;

      const total_attribs = iq + st + dx;
      const next_xp_idx = total_attribs - 32;
      const next_xp_cost = [100, 200, 300, 600, 1000, 2000, 4000];
      const total_xp_needed = [0, 100, 300, 600, 1200, 2200, 4200, 8200, 16200];

      const setting = {};
      setting["total_attribs"] = total_attribs;
      setting["next_attrib_xp"] = (next_xp_idx >= 0) ? next_xp_cost[next_xp_idx] : 0;
      setting["attrib_xp_spent"] = (next_xp_idx >= 0) ? total_xp_needed[next_xp_idx] : 0;

      setting["adj_st"] = st + st_bonus;
      setting["adj_dx"] = dx + dx_bonus;
      setting["adj_iq"] = iq + iq_bonus;

      setAttrs(setting);
    });
  });

  // Talents
  // Keep spells up to date
  on(`change:repeating_talents remove:repeating_talents change:class` , function () {
    getSectionIDs('repeating_talents', function (ids) {
      const fieldnames = [];
      ids.forEach(id => {
        fieldnames.push('repeating_talents_' + id + '_talent_cost');
      });
      getAttrs([...fieldnames, 'class'], function (values) {
        const c_class = values.class.trim();
        const is_wizard = (c_class === 'wizard') ? 1 : 0;

        settings = {};
        var total_talent_cost = 0;
        ids.forEach(id => {
           const talent_cost = parseInt(values['repeating_talents_' + id + '_talent_cost']) || 0;
           total_talent_cost += talent_cost;
        });

        settings['total_talent_cost'] = total_talent_cost;
        setAttrs(settings);
      });
    });
  });


  // Spells
  // Keep spells up to date
  on(`change:repeating_spells remove:repeating_spells change:class` , function () {
    getSectionIDs('repeating_spells', function (ids) {
      const fieldnames = [];
      ids.forEach(id => {
        fieldnames.push('repeating_spells_' + id + '_is_dice_spell');
        fieldnames.push('repeating_spells_' + id + '_spell_dice');
      });
      getAttrs([...fieldnames, 'class'], function (values) {
        const c_class = values.class.trim();
        const is_wizard = (c_class === 'wizard') ? 1 : 0;
        const num_spells = ids.length || 0;

        settings = {};
        ids.forEach(id => {

          const spell_dice = values['repeating_spells_' + id + '_spell_dice'];
          const is_dice_enabled = (spell_dice === "") ? 0 : 1;

          settings['repeating_spells_' + id + '_is_dice_spell'] = is_dice_enabled;

        });

        settings['num_spells'] = num_spells;
        setAttrs(settings);
      });
    });
  });

  // Languages
  on(`change:repeating_languages remove:repeating_languages` , function () {
    getSectionIDs('repeating_languages', function (ids) {
      const num_languages = parseInt(ids.length) || 0;

      settings = {};
      settings['num_lang'] = num_languages;
      setAttrs(settings);
    });
  });

  // XP for Talents, Spells, Languages
  on(`change:total_talent_cost change:num_lang change:num_spells change:iq change:class change:iq_start` , function () {
    getAttrs(['total_talent_cost', 'num_spells', 'num_lang', 'class', 'iq_start'], v => {

      const c_class = v.class.trim();
      const is_wizard = (c_class === 'wizard') ? 1 : 0;
      const talent_iq_cost = parseInt(v.total_talent_cost) || 0;
      const spell_iq_cost = parseInt(v.num_spells) || 0;
      // subtract 1 for first language which is free
      const lang_iq_cost = (parseInt(v.num_lang) || 0) - 1;
      const iq_start = parseInt(v.iq_start) || 0;

      // calculate XP needed
      var xp_required = 0;
      var iq_available = iq_start;

      // talent xp cost
      iq_available -= talent_iq_cost;
      if (iq_available < 0) {
          xp_required -=  500 * iq_available;
          iq_available = 0;
      }

      // language cost
      iq_available -= lang_iq_cost;
      if (iq_available < 0) {
        xp_required -= 500 * (iq_available + 1);
        iq_available = 0;
      }

      // spell cost
      iq_available -= spell_iq_cost * (is_wizard ? 1 : 3);
      if (iq_available < 0) {
        xp_required -= 500 * iq_available;
        iq_available = 0;
      }

      settings = {};
      settings['tls_iq_unspent'] = iq_available;
      settings['tls_xp_cost'] = xp_required;
      setAttrs(settings);

    });

  });

  on(`change:tls_xp_cost change:attrib_xp_spent` , function () {
    getAttrs(['tls_xp_cost', 'attrib_xp_spent'], v => {
      const attrib_xp_cost = parseInt(v.attrib_xp_spent) || 0;
      const tls_xp_cost = parseInt(v.tls_xp_cost) || 0;

      setAttrs({'xp_required': tls_xp_cost + attrib_xp_cost})

    });
  });

</script>
